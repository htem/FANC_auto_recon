Convolutional neural networks were trained to predict the locations of postsynaptic sites and their corresponding presynaptic sites in the EM dataset using the method described in [Buhmann et al. 2021 _Nature Methods_](https://www.nature.com/articles/s41592-021-01183-7). The implementation of this pipeline is available on Github at [funkelab/synful](https://github.com/funkelab/synful).

[This neuroglancer link](https://neuromancer-seung-import.appspot.com/#!%7B%22layers%22:%5B%7B%22source%22:%22precomputed://gs://lee-lab_female-adult-nerve-cord/alignmentV4/em/rechunked%22%2C%22type%22:%22image%22%2C%22blend%22:%22default%22%2C%22shaderControls%22:%7B%7D%2C%22name%22:%22FANCv4%22%7D%2C%7B%22source%22:%22precomputed://gs://lee-lab_female-adult-nerve-cord/alignmentV4/synapses/postsynapses_May2021%22%2C%22type%22:%22image%22%2C%22blend%22:%22default%22%2C%22shader%22:%22void%20main%28%29%20%7B%20emitRGBA%28vec4%281%2C%200%2C%201%2C%20toNormalized%28getDataValue%28%29%29%29%29%3B%20%7D%22%2C%22shaderControls%22:%7B%7D%2C%22name%22:%22postsynapses_May2021%22%7D%2C%7B%22source%22:%22precomputed://gs://lee-lab_female-adult-nerve-cord/alignmentV4/synapses/vectors_May2021%22%2C%22type%22:%22image%22%2C%22blend%22:%22default%22%2C%22shader%22:%22void%20main%28%29%20%7B%20emitRGB%28vec3%28%28clamp%28getDataValue%280%29%2C%20-100.0%2C%20100.0%29+100.0%29/200.0%2C%20%28clamp%28getDataValue%281%29%2C%20-100.0%2C%20100.0%29+100.0%29/200.0%2C%20%28clamp%28getDataValue%282%29%2C%20-100.0%2C%20100.0%29+100.0%29/200.0%29%29%3B%20%7D%22%2C%22shaderControls%22:%7B%7D%2C%22name%22:%22vectors_May2021%22%7D%5D%2C%22navigation%22:%7B%22pose%22:%7B%22position%22:%7B%22voxelSize%22:%5B4.300000190734863%2C4.300000190734863%2C45%5D%2C%22voxelCoordinates%22:%5B42258.125%2C111597.5625%2C2220%5D%7D%7D%2C%22zoomFactor%22:5.466371588853563%7D%2C%22gpuMemoryLimit%22:4000000000%2C%22systemMemoryLimit%22:4000000000%2C%22concurrentDownloads%22:64%2C%22layout%22:%224panel%22%7D) shows the two layers output by the two CNNs: one predicts whether a given pixel is a postsynaptic site, and the other predicts vectors pointing from postsynaptic sites to presynaptic sites.

From the postsynaptic site predictions, ~85 million postsynaptic sites were extracted. The ~85 million corresponding presynaptic sites were identified via the vector predictions at each postsynaptic site. The full set of ~85 million synaptic links can be found in the google cloud storage bucket [gs://zetta_lee_fly_vnc_001_alignment_temp/v4/fill_nearest_mip1/img/img_seethrough/synful_extraction/229bd2f77b2adf7c0e2c5b90ed605098/8.6_8.6_45/](https://console.cloud.google.com/storage/browser/zetta_lee_fly_vnc_001_alignment_temp/v4/fill_nearest_mip1/img/img_seethrough/synful_extraction/229bd2f77b2adf7c0e2c5b90ed605098/8.6_8.6_45)

A score threshold was then applied to filter out putative false positive predictions, resulting in 52.7 million remaining synaptic links. (TODO confirm the details of how thresholding was done, but if memory serves, we thresholded the sum or area score at 14. This roughly means that a postsynaptic site had to contain at least 14 voxels to pass the threshold and be kept. This particular threshold was chosen by comparing the results of different thresholds with ground truth synapse annotations that were held out from the training set given to the CNNs.)

This set of 52.7 million synaptic links is available through:
* CAVEclient in a table named [synapses_jan2022](https://cave.fanc-fly.com/annotation/views/aligned_volume/fanc_v4/table/synapses_jan2022)
* Google drive as a 4.25GB .csv file: [link](https://drive.google.com/drive/folders/1L7Zp2ek0At14b-dqe-g06ZNo9JH3Wxda)

